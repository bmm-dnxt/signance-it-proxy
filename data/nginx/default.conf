# default common configurations

map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}


upstream backend {
   server backend:5555;
   keepalive 32;
}

upstream frontend {
   server frontend:5555;
   keepalive 32;
}

upstream backoffice {
   server backoffice:5555;
   keepalive 32;
}

upstream cms {
   server wordpress:8080;
   keepalive 32;
}

upstream sso {
   server keycloak:8080;
   keepalive 32;
}

proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=default_cache:10m max_size=3g inactive=120m use_temp_path=off;

server {
    listen 80 default_server;
    #server_name jitsi.dnxt.space;
    
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }    

    location / {
	    return 301 https://$host$request_uri;
    }

}

